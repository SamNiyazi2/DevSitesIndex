@model DemoSitesViewModel
@using DevSitesIndex.Entities
@{
    ViewData["Title"] = "Index";



}


<h1>Demo Sites Index (p1)</h1>

@{await Html.RenderPartialAsync("Index_Option_Select");}

<div id="show-job" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <h1>Show job</h1>
        </div>
    </div>
</div>

<div id="del-confirm" class="modal" tabindex="-1" role="dialog" aria-labelledby="del-confirm-label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h2>
                    <span class="modal-title">Delete Confirmation</span>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X </button>
                </h2>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this item?</p>
                <p class="alert alert-danger "><strong>Note:</strong> There is no undo for this action.</p>

            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal">Close</button>
                <button class="btn btn-primary" data-bind="click: del">Delete item</button>
            </div>
        </div>
    </div>

</div>

<div id="error-container" class="hide">
    <div class="alert alert-danger">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <h4>Error!</h4>
        <p>Something went wrong:</p>
        <p data-bind="text: errorMessage"></p>
    </div>
</div>





<h3>Source: Bootstrap (list-container template)</h3>
<hr />


<div id="list-container">

    <div data-bind="template: {name: 'list-template', foreach: devSitesJSON }"></div>

</div>





@section Scripts {


    <script type="text/html" id="list-template">

        <div class="container-fluid">


            @*03/19/2019 11:01 pm - SSN -*@
            <div data-bind="attr: { class: $parent.getClassForDemoState(forDemo_v02)}">
                @*class="siteDiv"*@


                @*// 03/29/2019 10:03 pm - SSN - Add div siteTitleDiv title to give space*@
                <div class="siteTitleDiv">



                    @*// 03/19/2019 07:04 pm - SSN - [20190319-1904]*@

                    [<span data-bind="text: docAge"></span>]
                    <!-- ko if:  $data.siteUrl -->
                    <!-- ko ifnot:  $parent.checkIfcallingcmd(siteUrl)-->

                    <a class="siteTitle" data-bind="attr:{   href:siteUrl ,  target:'window_' + id }"><span data-bind="text: siteTitle"></span></a>
                    <!-- /ko -->
                    <!-- ko if:  $parent.checkIfcallingcmd(siteUrl) -->

                    <a class="siteTitle" data-bind="attr:{   href:'ssnalert:appcode=' + softwareCodeID + ';title='+ siteTitle +';targetfile='+$parent.siteUrlWithoutCMD(siteUrl)  }"><span data-bind="text: siteTitle"></span></a>
                    <p class="alert-danger">Runs CMD</p>
                    <!-- /ko -->
                    <!-- /ko -->
                    <!-- ko ifnot:  $data.siteUrl -->
                    <span class="siteTitle" data-bind="text: siteTitle"></span>

                    <!-- /ko -->

                </div>



                <!-- ko if: $data.solution_Details -->
                @*02/05/2019 02:11 pm - SSN - Testing decoding html*@
                @*<div class="solution_details" data-bind="text:solution_Details">*@
                <div class="solution_details" data-bind="html:solution_Details">
                </div>
                <!-- /ko -->

                <br />

                <div class="menuOptions">

                    <a href="#" class=""
                       data-bind="click: $parent.showJob">Show Job</a>

                    <a href="#" class=""
                       data-bind="click: $parent.requestDelConfirm">Delete</a>

                    <a class=""
                       data-bind="attr: {href: '/devsites/details?id=' + id , target:'devsiteIndexWindow' + id } ">Detail</a>



                    @*// 03/19/2019 12:06 am - SSN - [20190318-2350] Added*@
                    <div data-bind="if: canBeLaunched">
                        <div data-bind="template: { name: 'launchOption'}">

                        </div>
                    </div>




                </div>
                <hr />
            </div>
        </div>
    </script>


    @*08/21/2018 02:46 am - SSN - Copied - End*@


    @*// 03/19/2019 12:58 am - SSN - [20190318-2350] Added*@
    @*// 04/19/2019 10:57 am - SSN - Make generic*@

    <script type="text/html" id="launchOption">

        <div data-bind="if: softwareCodeID > 0">
            <p>
                Project: <a data-bind="attr:{   href:'ssnalert:appcode=' + softwareCodeID + ';title='+ siteTitle +';targetfile='+solutionName }"><span data-bind="text: solutionName"></span></a>
            </p>
        </div>

    </script>

    <script src="~/js/DemoSites.js" asp-append-version="true"></script>




    @*
        08/21/2018 02:46 am - SSN - Copied - Begin
        08/21/2018 02:46 am - SSN - Copied from C:\Sams_Projects\PluralSight\html5-line-of-business-applications\d\demos\CodedHomes.Web\Views\Homes
    *@
    <script>

        // Knockout related

    $(function () {

        var ViewModel = function () {


            this.currentItem = {};

            this.errorMessage = ko.observable();

            this.devSitesJSON = ko.observableArray(@Html.Raw(Model.devSitesJSON));

            this.requestDelConfirm = function (itemToDelete) {

                vm.currentItem = itemToDelete;
                $('#del-confirm').modal({ backdrop: 'static', keyboard: false });

            };


            this.showJob = function () {

                $('#show-job').modal();

            };


            this.del = function () {
                alert('Calling del!!!!');
                var itemToDelete = ko.toJS(vm.currentItem);
                $('#del-confirm').modal('hide');

            };



            this.checkIfcallingcmd = function (siteUrl) {
                if (stringStartsWith(siteUrl , 'cmd')) {
                    return true;

                }
            };

            this.siteUrlWithoutCMD = function (siteUrl) {
                if (stringStartsWith(siteUrl, 'cmd')) {
                    return siteUrl.substring(4);
                }
                else {

                    return siteUrl;
                }
            };


            this.getClassForDemoState = function (forDemo_v2) {

                let selectedClass = "";

                switch (forDemo_v2) {
                    case 1:
                        selectedClass = ' forDemo_Yes';
                        break;

                    case 2:
                        selectedClass =  'forDemo_No';
                        break;

                    case 3:
                        selectedClass = 'forDemo_Undecided';
                        break;

                }

                return "siteDiv" + " " + selectedClass;

            };


        };

        var vm = new ViewModel();
        ko.applyBindings(vm);
    });

        var stringStartsWith = function (string, startsWith) {
            string = string || "";
            if (startsWith.length > string.length)
                return false;
            return string.substring(0, startsWith.length) === startsWith;
        };

    </script>





}
